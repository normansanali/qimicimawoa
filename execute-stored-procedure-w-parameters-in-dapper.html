<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Execute stored procedure w/parameters in Dapper - JadeW</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="I'm using Dapper (thanks Sam, great project.) a micro ORM with a DAL and by some reason I'm not able to execute stored procedures with input parameters. In a example service I've the following code: When the execution of the stored procedure is triggered a SqlException is thrown stating that I need to provide the"><meta name=robots content="index,follow,noarchive"><meta property="og:title" content="Execute stored procedure w/parameters in Dapper"><meta property="og:description" content="I'm using Dapper (thanks Sam, great project.) a micro ORM with a DAL and by some reason I'm not able to execute stored procedures with input parameters. In a example service I've the following code: When the execution of the stored procedure is triggered a SqlException is thrown stating that I need to provide the"><meta property="og:type" content="article"><meta property="og:url" content="/execute-stored-procedure-w-parameters-in-dapper.html"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-08-31T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-31T00:00:00+00:00"><meta itemprop=name content="Execute stored procedure w/parameters in Dapper"><meta itemprop=description content="I'm using Dapper (thanks Sam, great project.) a micro ORM with a DAL and by some reason I'm not able to execute stored procedures with input parameters. In a example service I've the following code: When the execution of the stored procedure is triggered a SqlException is thrown stating that I need to provide the"><meta itemprop=datePublished content="2024-08-31T00:00:00+00:00"><meta itemprop=dateModified content="2024-08-31T00:00:00+00:00"><meta itemprop=wordCount content="507"><meta itemprop=keywords content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=https://assets.cdnweb.info/hugo/mainroad/css/style.css><link rel="shortcut icon" href=./favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=./index.html title=JadeW rel=home><div class="logo__item logo__text"><div class=logo__title>JadeW</div></div></a></div><div class=divider></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Execute stored procedure w/parameters in Dapper</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2024-08-31T00:00:00Z>August 31, 2024</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=./categories/blog/ rel=category>blog</a></span></div></div></header><div class="content post__content clearfix"><img src=https://cdn.statically.io/img/cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png style=margin:auto;display:block;text-align:center;max-width:100%;height:auto><p>I'm using <a href=# rel="nofollow noreferrer">Dapper</a> (thanks <a href=# rel="nofollow noreferrer">Sam</a>, great project.) a micro ORM with a DAL and by some reason I'm not able to execute stored procedures with input parameters.</p><p>In a example service I've the following code:</p><pre class="lang-cs prettyprint-override"><code>public void GetSomething(int somethingId) { IRepository&lt;Something, SomethingEnum&gt; repository = UnitOfWork.GetRepository&lt;Something, SomethingEnum&gt;(); var param = new DynamicParameters(); param.Add("@somethingId", dbType: DbType.Int32, value:somethingId, direction: ParameterDirection.Input); var result = repository.Exec&lt;Something&gt;(SomethingEnum.spMyStoredProcedure, param); ... } </code></pre><p>When the execution of the stored procedure is triggered a SqlException is thrown stating that I need to provide the 'somethingId'</p><p>Procedure or function 'spMyStoredProcedure' expects parameter '@somethingId', which was not supplied.</p><p>My <a href=# rel="nofollow noreferrer">DAL</a> is similar based on this github project of Pencroff.</p><p>Am I missing something here?</p><p><strong>Update:</strong> I am actually passing the commandType via the SomethingEnum:</p><pre class="lang-cs prettyprint-override"><code>public class SomethingEnum : EnumBase&lt;SomethingEnum, string&gt; { public static readonly SomethingEnum spMyStoredProcedure = new SomethingEnum("spMyStoredProcedure", "[dbo].[spMyStoredProcedure]", CommandType.StoredProcedure); public SomethingEnum(string Name, string EnumValue, CommandType? cmdType): base(Name, EnumValue, cmdType) { } } </code></pre><span class=d-none itemprop=commentCount></span><h2 class=mb0 data-answercount=5>5 Answers</h2><p>You need to tell it the command type: make sure there's a <code>commandType: CommandType.StoredProcedure</code> in the dapper call. Otherwise, it is simply executing the <strong>text</strong> command:</p><pre><code>spMyStoredProcedure </code></pre><p>(with some unused parameters in the ambient context). This is legal TSQL, and attempts to call <code>spMyStoredProcedure</code> without passing parameters - the same as if you put <code>spMyStoredProcedure</code> into SSMS and press f5.</p><p>Also, if your parameters are fixed, I would actually suggest just using:</p><pre><code>var param = new { somethingId }; </code></pre><p>or even just inline it completely:</p><pre><code>var result = repository.Exec&lt;Something&gt;(SomethingEnum.spMyStoredProcedure, new { somethingId }, commandType: CommandType.StoredProcedure); </code></pre><p>(note: if your <code>Exec&lt;T></code> method only ever handles stored procedures, you could move the <code>commandType</code> internal to the method - or you could make it an optional parameter that defaults to <code>CommandType.StoredProcedure</code>)</p><span class=d-none itemprop=commentCount>6</span><pre><code>var queryParameters = new DynamicParameters(); queryParameters.Add("@parameter1", valueOfparameter1); queryParameters.Add("@parameter2", valueOfparameter2); await db.QueryAsync&lt;YourReturnType&gt;( "{NameOfStoredProcedure}", queryParameters, commandType: CommandType.StoredProcedure) </code></pre><span class=d-none itemprop=commentCount>1</span><p>Since this was the top result for me, but there were no answers that deal with ExecuteNonQuery with table valued parameters, here is the code for that:</p><pre><code>var queryParameters = new DynamicParameters(); queryParameters.Add("@Param0", datatable0.AsTableValuedParameter()); queryParameters.Add("@Param1", datatable1.AsTableValuedParameter()); var result = await ExecuteStoredProc("usp_InsertUpdateTest", queryParameters); private async Task&lt;Result&lt;int&gt;&gt; ExecuteStoredProc(string sqlStatement, DynamicParameters parameters) { try { using (SqlConnection conn = new SqlConnection(connectionString)) { await conn.OpenAsync(); var affectedRows = await conn.ExecuteAsync( sql: sqlStatement, param: parameters, commandType: CommandType.StoredProcedure); return Result.Ok(affectedRows); } } catch (Exception e) { //do logging return Result.Fail&lt;int&gt;(e.Message); } } </code></pre><span class=d-none itemprop=commentCount>2</span><p>You'll need to extend it to support outbound parameters and returning results, but it contains the portion for creating the Dapper dynamic parameters.</p><pre><code>internal static bool ExecuteProc(string sql, List&lt;SqlParameter&gt; paramList = null) { try { using (SqlConnection conn = new SqlConnection (GetConnectionString())) { DynamicParameters dp = new DynamicParameters(); if(paramList != null) foreach (SqlParameter sp in paramList) dp.Add(sp.ParameterName, sp.SqlValue, sp.DbType); conn.Open(); return conn.Execute(sql, dp, commandType: CommandType.StoredProcedure) &gt; 0; } } catch (Exception e) { //do logging return false; } </code></pre><p>}</p><span class=d-none itemprop=commentCount>2</span><p>This works for me. Note that the method doing this is async, hence the await and QueryAsync. Also notice that an anonymous type is created to facilitate the 'Id' parameter being sent.</p><pre><code>await dbConnection.QueryAsync&lt;Something&gt;("StoredProcedureNameGoesHere @Id", new { Id = id }); </code></pre><span class=d-none itemprop=commentCount></span><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmirpJawrLvVnqmfpJ%2Bse6S7zGiorp2jqbawutJoaWptaW2BdIOOnq%2Bem6Wpsm6%2F06ipnpxdpb%2Bwr8SdrKudXax6sa3RmqSerJWnwG61zWabmqigmr8%3D</p></div></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=./mark-ruffalo-supports-jeremy-renner-snow-plow-accident.html rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>Mark Ruffalo Supports Jeremy Renner After Snow Plow Accident Hollywood Life</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=./today-dylan-dreyer-husband-heartbreaking-tribute-following-tragic-death.html rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>Dylan Dreyer's husband pens heartbreaking tribute and shares personal photos following double loss</p></a></div></nav></div><aside class=sidebar><div class="widget-recent widget"><h4 class=widget__title>Recent Posts</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=./3-healthy-green-juice-recipes.html>3 Healthy Green Juice Recipes</a></li><li class=widget__item><a class=widget__link href=./dua-lipa-hooded-jumpsuit-leather-coat-saint-laurent.html>Dua Lipa Is Effortlessly Cool in a Hooded Jumpsuit and Floor-Length Leather Coat</a></li><li class=widget__item><a class=widget__link href=./janelle-brown-talking-to-kody-brown-about-other-wives-is-dangerous.html>Janelle Brown: Talking to Kody Brown About Other Wives Is 'Dangerous'</a></li><li class=widget__item><a class=widget__link href=./princess-misty-3.html>Princess Misty Age, Net Worth, Boyfriend, Family and Biography (Updated 2023)</a></li><li class=widget__item><a class=widget__link href=./10-moments-from-season-6-the-crown-that-are-historically-inaccurate-or-ambiguous.html>10 moments from season 6 The Crown that are historically inaccurate or ambiguous</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>Categories</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=./categories/blog/>blog</a></li></ul></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2024 JadeW.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=https://assets.cdnweb.info/hugo/mainroad/js/menu.js></script>
<script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>